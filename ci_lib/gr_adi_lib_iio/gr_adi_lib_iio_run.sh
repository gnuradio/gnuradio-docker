#!/usr/bin/env bash

# Copyright (c) 2020 - 2021 Adam Horden <adam.horden@horden.engineering>

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

set \
  -o \
    "errexit" \
  -o \
    "xtrace" \

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

export DOCKER_BUILDKIT="$(\
  printf \
    "%d" \
    "1" \
)"

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

export GR_BLD_ARCH="$(\
  printf \
    "%s" \
    "$( \
      uname \
      -m \
    )" \
)"

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

docker \
  build \
  --build-arg \
      GR_BLD_ARCH="${GR_BLD_ARCH}" \
  --build-arg \
      GR_ADI_LIB_IIO_SRC="https://github.com/analogdevicesinc/libiio.git" \
  --build-arg \
      GR_ADI_LIB_IIO_SRC_BR="v0.21" \
  --build-arg \
      GR_ADI_LIB_IIO_SRC_VER="v_0_21" \
  --file \
      "gr_adi_lib_iio" \
  --progress \
      "plain" \
  --tag \
      "gr_adi_lib_iio:v0.21" \
  "$(pwd)"

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

# docker \
#   image \
#     tag \
#       "gr_adi_lib_iio:v0.21" \
#       "gnuradio/gr_adi_lib_iio:v0.21"

# ----------------------------------------------------------------------------------------
#
# ----------------------------------------------------------------------------------------

# docker \
#   push \
#     "gnuradio/gr_adi_lib_iio:v0.21"
